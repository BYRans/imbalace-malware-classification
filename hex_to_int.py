from operator import itemgetter
from collections import Counter
import time
import os
import json
import re
import string


def get_words_list(filename):
    try:
        with open(filename) as f_obj:
            content = f_obj.read()
    except FileNotFoundError:
        msg = "The file " + filename + " does not exist."
        print(msg)
    else:
        content = content.replace('+', ' ')
        content = content.replace('??', ' ')
        words = [word for word in content.split()]
        return words


def count_results(raw_data_path):
    words_count_total = {}

    allFileNames = sorted(os.listdir(raw_data_path))
    allFileNames = [f_name for f_name in allFileNames if f_name.endswith('.txt')]

    filesCount = len(allFileNames)
    print("text files count is: ",filesCount)

    count=0
    for filename in allFileNames:
        if (count % 100) == 0:
            print("text progressed: ",count,"/",filesCount)
            print("The number of words has reached: ",len(words_count_total))
        count += 1
        words_list = get_words_list(raw_data_path + filename)
        for word in words_list:
            if word not in words_count_total:
                words_count_total[word] = 1
            else:
                words_count_total[word] += 1
    return words_count_total


def hex_to_int(raw_data_path):
    int_hex_path = 'G:/数据集/Microsoft/RunningOutput/int_hex/'

    allFileNames = sorted(os.listdir(raw_data_path))
    allFileNames = [f_name for f_name in allFileNames if f_name.endswith('.txt')]

    file_count = len(allFileNames)
    count = 0
    for f_name in allFileNames:
        if (count % 100) == 0:
            print("hex to int: ",count,"/",file_count)
        count += 1
        words = get_words_list(raw_data_path + f_name)
        int_hex = []
        for word in words:
            isHex = all(w in string.hexdigits for w in word)
            if isHex:
                hex = int(word,16)
                int_hex.append(str(hex))
        fw = open(int_hex_path + f_name[:-4] + 'Numbers.txt', 'w', encoding='utf-8')
        int_text_str = " ".join(int_hex)
        fw.write(int_text_str)
        fw.close()



if __name__ == '__main__':
    raw_data_path = 'G:/数据集/Microsoft/RunningOutput/hex/'
    # get_text_dic(raw_data_path,text_word_index_fname)
    hex_to_int(raw_data_path)


